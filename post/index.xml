<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on CodeAndBugs</title><link>https://www.codeandbugs.com/post/</link><description>Recent content in Posts on CodeAndBugs</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 22 Mar 2024 20:13:34 +0100</lastBuildDate><atom:link href="https://www.codeandbugs.com/post/index.xml" rel="self" type="application/rss+xml"/><item><title>The Poker Theory of Poker Night</title><link>https://www.codeandbugs.com/post/poker-theory-poker-night/</link><pubDate>Fri, 22 Mar 2024 20:13:34 +0100</pubDate><guid>https://www.codeandbugs.com/post/poker-theory-poker-night/</guid><description>&lt;p>A group of friends and I occasionally like to get together to play Poker. Yet
something keeps happening that I have observed time and again with these kinds
of group gatherings: It is hard to find a suitable date and then on top people
cancel last minute. This is demotivating for other participants, who in turn
also become less committed and this often leads to such groups failing.&lt;/p>
&lt;p>Here is one theory of why this happens and how to solve it, explained with
Poker. This article will assume Texas Hold&amp;rsquo;em Poker, probably the most popular
variant.&lt;/p>
&lt;p>tl;dr People&amp;rsquo;s incentives are not aligned. The solution is to create a social
rule that makes folding (canceling attendance) have a bit of negative EV.&lt;/p>
&lt;h2 id="aside-poker-basics">Aside: Poker Basics&lt;/h2>
&lt;p>You can skip this section if you are familiar with Texas Hold&amp;rsquo;em Poker.&lt;/p>
&lt;p>Poker is played with a standard deck of 52 cards and with 2 to 9 players.&lt;/p>
&lt;p>The game is played over many game rounds that are called hands. Unfortunately
hand also refers to the specific cards that a player is holding, which can be a
little confusing.&lt;/p>
&lt;p>At the beginning of the hand each player gets two cards that only the player
themself gets to see. These are the pocket cards. For example A♣️ and A♦️.&lt;/p>
&lt;p>Then over the course of several rounds up to a total of 5 cards are added to the
middle of the table, face-up i.e. everyone gets to see them. These are the
community cards. For example 9♦️, T♠️, A♠️, Q♣️ and A♥️. (&lt;strong>Note:&lt;/strong> T stands for
10 so that all ranks can be written using a single character: 2, 3, 4, 5, 6, 7,
8, 9, T, J, Q, K, A).&lt;/p>
&lt;p>&lt;img src="pocket-community-cards.jpg" alt="A player holding their pocket cards and in the back the five community cards
on the table.">&lt;/p>
&lt;p>&lt;small>Above you see a player holding their pocket cards and in the back the
five community cards on the table.&lt;/small>&lt;/p>
&lt;p>At the end of the hand during the &lt;em>showdown&lt;/em> each player gets to choose 5 total
cards out of the 7 available cards (their two pockets cards plus the five
community cards). All players share the community cards so they can be used
multiple times. For example the player in the example above would choose A♣️,
A♦️, A♠️, A♥️ and Q♣️ for a final hand combination of four of a kind aces and
queen kicker (which is a very strong hand). The fact that this player used two
aces and the queen from the community cards does NOT prevent other players from
using them too.&lt;/p>
&lt;p>The strongest hand wins and takes the money in the center of the table (the
pot).&lt;/p>
&lt;p>The hands are ranked from the strongest, Royal Flush (e.g. A♦️, K♦️, Q♦️, J♦️
and T♦️), all the way to the weakest, High Card (e.g. A♥️, 8♠️, 5♦️, 3♣️ and
2♣️). Read more about hands rankings
&lt;a href="https://www.pokerstars.com/poker/learn/lesson/poker-hand-rankings/">here&lt;/a>.&lt;/p>
&lt;p>Of course there are many details missing, in particular during the hand there
are several rounds where players can place bets and raise the bets of other
players. This means that the showdown is not always reached since it can happen
that all players except one &lt;em>fold&lt;/em> (give up). Then the only remaining player is
the automatic winner of that hand and takes the pot. Read some more about the
rules &lt;a href="https://www.pokerstars.com/poker/games/texas-holdem/">here&lt;/a> or
&lt;a href="https://en.wikipedia.org/wiki/Texas_hold_'em">here&lt;/a>.&lt;/p>
&lt;p>A few other concepts that appear in this article:&lt;/p>
&lt;ul>
&lt;li>Chips: Small disks that represent money. In the image above you can see green,
white, red and blue chips on the table close to the player. Different colors
represent different amounts (e.g. green 10 cent, white 50 cent).&lt;/li>
&lt;li>Stack: The chips that are currently yours. In the image above those green,
white, red and blue chips are this player&amp;rsquo;s stack.&lt;/li>
&lt;li>Pot: The chips in the center of the table where all the bets by the different
players get added. The winner of a hand takes the pot and adds it to their
stack. At the very beginning of a hand the pot is usually empty.&lt;/li>
&lt;/ul>
&lt;h2 id="-back-to-the-main-article">&amp;hellip; Back to the Main Article&lt;/h2>
&lt;p>Let&amp;rsquo;s assume you are at the beginning of a Poker hand with just one other player
(Victoria) and you just got dealt A♥️ and A♠️ whereas she got dealt 7♥️ and 2♣️
(of course, in a real game you do not know what other players get dealt). No
community cards have been uncovered. Who of you is going to win at showdown?
That is impossible to predict, right? Well, not quite. You cannot make a certain
prediction, for example if the community cards end up being 7♠️, 7♣️, 2♦️, 8♣️
and 9♣️ then Victoria would win whereas if the community cards end up being A♦️,
3♦️, 5♠️, 2♥️ and K♠️ then you would win. Is there &lt;em>nothing&lt;/em> you can say about
how things might turn out before seeing the community cards?&lt;/p>
&lt;p>Yes you can say something, this is what is known as expected value (EV). What is
EV? Well it is the &lt;em>value&lt;/em> you &lt;em>expect&lt;/em> to gain (or lose) in a particular
situation. For example let&amp;rsquo;s say I offer you the following bet: I will flip a
fair coin. If it comes up heads I will give you &lt;span>$&lt;/span>1,000 and if it
comes up tails you have to give me &lt;span>$&lt;/span>10. Would you play?&lt;/p>
&lt;p>Think about it for a moment. Would you play and if yes, why? The coin is really
fair (i.e. not a trick coin that always comes up tails).&lt;/p>
&lt;p>&lt;img src="gold-dollar.webp" alt="Gold dollar obverse from 1852">&lt;/p>
&lt;p>Probably you would play, but why? After all, you &lt;em>could&lt;/em> simply lose
&lt;span>$&lt;/span>10, which is not the end of the world but still sucks, right? You
would play because the EV is positive, which you know intuitively even if you
did not calculate it (the exact calculation being: $EV = 0.5\times 1000 -
0.5\times 10 = 495$). You &lt;em>expect&lt;/em> (predict) the bet to generate positive
&lt;em>value&lt;/em> for you, on average.&lt;/p>
&lt;p>Another example, imagine you are applying for a new job. During the interview
for job H at Horrible Inc. you find that the pay is way below market, the tasks
are boring and the colleagues are pretty nasty. Job F at Fantastic Ltd. in turn
pays excellently, the tasks are fascinating and the colleagues are already your
best buddies after two hours. Which of the jobs would you pick? Why? You cannot
predict for &lt;em>sure&lt;/em> that at job H you would not meet exactly the person who will
put you on the path to becoming the happiest and most fulfilled you have ever
been. However, the expected value of picking job F is positive (i.e. you predict
it would make you happy) whereas the expected value of picking job H is negative
(i.e. you predict it would make you unhappy), therefore picking job F is the
sensible thing to do.&lt;/p>
&lt;p>How about in Poker, why can you say A♥️ A♠️ are better pocket cards than 7♥️
2♣️? Because on average the player with A♥️ A♠️ will win much more often than
the player with 7♥️ 2♣️. If you play A♥️ A♠️ against 7♥️ 2♣️, 100 times, A♥️ A♠️
would win about 87 times and 7♥️ 2♣️ would win about 13 times.&lt;/p>
&lt;p>Note: In the following paragraphs I&amp;rsquo;m making the assumption that there are no
blinds in Poker to make a point. If you don&amp;rsquo;t know what blinds are, it&amp;rsquo;s
explained later.&lt;/p>
&lt;p>So based only on your pocket cards you can already make a prediction how likely
it is you are going to win. If you get dealt pocket cards that have a low EV,
what is the sensible thing to do? Fold (i.e. give up) and wait for the next
hand. So just fold anything that is not the very strongest pocket cards i.e. AA,
AK or KK. In a table of 9 players everyone that does not have one of those hands
would just fold. In fact, once everyone realizes this is what is going on,
everyone would fold any hand except AA just to be on the safe side, since this
is the one with the highest EV in the entire game.&lt;/p>
&lt;p>Even before the community cards were dealt the winner would already be clear and
what is worse, the pot would not even contain any money because nobody would
have bet anything.&lt;/p>
&lt;p>That sounds like a truly terrible game!&lt;/p>
&lt;p>What could you do to solve this? One of you could say to the other players:
&amp;ldquo;Come on people, this is boring, we all want to see some action, let&amp;rsquo;s not fold
immediately but play a little!&amp;rdquo; Everyone would nod dutifully and do as
suggested&amp;hellip; right? Problem solved!&lt;/p>
&lt;p>Well, not really. Sooner or later one player would figure out that if they fold
their bad hands a little more frequently they would start losing a little less
and then other players would follow their example and everyone would end up
exactly where you started.&lt;/p>
&lt;p>This is why Poker has blinds. Blinds are obligatory bets placed at the beginning
of each hand blindly (without seeing their pocket cards) by two of the players.
Which two players rotates every hand.&lt;/p>
&lt;p>What is the point of the blinds? It makes the two players who posted the blinds
much more likely to play even with suboptimal pocket cards and it makes other
players more likely to play too because they know the players who posted the
blinds might be playing with suboptimal pocket cards so they can be beaten plus
if other players fold easily then the pot is essentially free money. The entire
game of Poker is only possible because of the blinds.&lt;/p>
&lt;p>Sometimes Poker is also played with additional obligatory bets that &lt;em>all&lt;/em>
players have to post at the beginning of the game called ante. This stimulates
the game even further.&lt;/p>
&lt;p>Each player would prefer never having to post blinds or antes. Instead the player
would prefer looking at their own pocket cards and then deciding to either fold
or place a bet. However, this makes the game as a whole collapse and that is why
the added incentive of blinds and antes is needed.&lt;/p>
&lt;h2 id="returning-to-poker-nights">Returning to Poker nights&lt;/h2>
&lt;p>&amp;hellip; and other similar gatherings. Let&amp;rsquo;s assume everyone who joins generally
enjoys it. At the same time, Poker night is not their highest priority in life.
There are about 56 other things that, given the right circumstances, take
priority over Poker night for each person. Therefore, for each person what
&lt;em>would be perfect&lt;/em> is to know that Poker night takes place and that enough other
people participate (because then it&amp;rsquo;s more fun) but that they themself can
decide spontaneously up to the last minute whether they are going to join or
not. This maximizes their EV because they get to choose out of all the options
they have available that evening the one option that suits them the most, which
could be catching up with that other friend they have been wanting to meet for
ages, going to the cinema with their partner, recharging after a long week by
staying home or in fact going to Poker night. The alternatives are all
reasonable things people enjoy doing and it make total sense that they would
sometimes or even always take priority over Poker night. Not to speak of
emergencies and illness. Going to Poker night right after breaking your arm
might be &lt;em>possible&lt;/em> but has a very negative EV.&lt;/p>
&lt;p>However, how does this impact the other people who want to come to Poker night?
If I predict that everyone else might cancel last minute due to other plans then
I will proactively start making other plans because being stuck with a canceled
event at the last minute or playing Poker with just one or two other people is
not that much fun. If I start making other plans and canceling Poker night
attendance this again negatively impacts the likelihood of other people
attending and so on&amp;hellip; it&amp;rsquo;s a vicious cycle.&lt;/p>
&lt;p>Everyone maximizes their own EV by committing as late as possible even though
this threatens the evening as a whole, much the same way that Poker as a game
does not work if everyone folds all pocket cards except AA.&lt;/p>
&lt;p>So, what is the solution? Create a social rule that makes folding (canceling
attendance) have a little bit of negative EV much like the blinds and antes do
in Poker.&lt;/p>
&lt;p>Some examples:&lt;/p>
&lt;ul>
&lt;li>If someone said they would attend but they do not, they have to buy a round of
drinks for everyone the next time they come.&lt;/li>
&lt;li>If someone commits to attending they have to transfer the money for the first
buy-in (or a fraction of it) to the host of the evening. If the participant
cancels after this, they get no refund and their money gets added to the pot
in small increments.&lt;/li>
&lt;li>Use social pressure, reputation or shame to make &lt;em>folding&lt;/em> expensive.
Presumably this is what many groups do implicitly without ever consciously
deciding on it. If your bowling group gives Pedro the cold shoulder after he
failed to come for the second time, this is what is going on.&lt;/li>
&lt;/ul>
&lt;p>Just like in Poker the negative impact should be small. There is a reason why
blinds and antes are small amounts compared to your entire stack. This means
that the Poker players who posted the blinds still have the option of folding if
they get really terrible cards. They are not obligated to play every hand.
Concerning gatherings, it means that if someone has got some other activity they
really want to participate in instead of Poker night, they also have that
option. In both cases they just have to accept the small price of losing the
blind.&lt;/p>
&lt;p>I think one of the main reasons why this works in the game of Poker and why I
predict it also works in gatherings is that it creates incentives to behave in a
certain way but much &lt;strong>more importantly&lt;/strong> it creates &lt;strong>common knowledge&lt;/strong> that
those incentives exist, meaning everyone is able to rely much more on other
people&amp;rsquo;s behavior and due to this fact they themself start behaving in ways that
benefit the game (or group) more. (Common knowledge means all participants know
the rules. It also means that all participants know that all other participants
know the rules. And it also means that all participants know that all other
participants know that all participants know the rules. And so on.)&lt;/p>
&lt;p>To re-iterate: The analogy this article is making is that before playing a hand
in Poker if I had the choice I would always look at my pocket cards before
making any bet. I would never voluntarily post blinds or antes. However, this
makes the game not work. In social gatherings it is rational for me to delay my
decision as long as possible without committing because then I get to maximize
my expected value once I know how I am feeling and what options I have
available. This, however, is detrimental to the survival of the group.
Introducing an incentive that encourages committing and disencourages canceling
after having committed could have the same positive effect as blinds and antes do
in Poker, in particular by creating common knowledge about this very fact.&lt;/p>
&lt;p>Some alternative solutions:&lt;/p>
&lt;ul>
&lt;li>Make &lt;em>folding&lt;/em> extremely expensive so nobody ever does it. For example a
college course that ejects students who are absent even once (unless they
bring a doctor&amp;rsquo;s note).&lt;/li>
&lt;li>Make whathever the group is doing more attractive so that the EV of attending
increases, thus making attendees less likely to choose another activity. For
example, if you are organizing talks you can try to get more popular and
interesting speakers. Artificially limiting the number of available spots
could be another way of increasing the perceived value of the event.&lt;/li>
&lt;li>Increase the size of the pool of potential attendees. For example assume that
a group of 7 friends meets for lunch the last Sunday of every month.
Experience has shown that each of them is 70% likely to attend. This means
that on average about 5 friends attend each lunch. They would like to have at
least 6 people. They can achieve this by inviting more people. If N is the
number of potential participants, $N \times 0.7 \ge 6$ leads us to $N \ge 8.57$ i.e. They
need to invite at least 9 people total. Note that in reality of course
different people have different probabilities of attending.&lt;/li>
&lt;li>One person commits to the event always taking place no matter what. For
example in a discussion round one person can say: &amp;ldquo;Every Wednesday I will be
at Café Paris from 3 to 5 pm. If nobody else comes, I will read my own book.&amp;rdquo;
This will not fully solve the problem if the group size has an impact on
enjoyment since you can&amp;rsquo;t know how many people will attend.&lt;/li>
&lt;/ul>
&lt;p>Closing thoughts:&lt;/p>
&lt;ul>
&lt;li>This is just an idea I came up with. Maybe it&amp;rsquo;s completely wrong, probably
it&amp;rsquo;s missing some important considerations and probably others came up with
something very similar before. In particular, the whole thing can also be
framed as a &lt;a href="https://www.lesswrong.com/posts/zp5AEENssb8ZDnoZR/the-schelling-choice-is-rabbit-not-stag">stag
hunt&lt;/a>.&lt;/li>
&lt;li>Introducing (monetary) &lt;em>punishments&lt;/em> (an incentive can easily be understood as
a punishment) to social relationships can probably do a lot of damage, so be
careful.&lt;/li>
&lt;li>Talking about EV when meeting friends could be perceived as cold and could
damage relationships, so again, be careful. Not everyone likes
thinking and talking explicitly about such things.&lt;/li>
&lt;li>Very few people exclusively maximize their own EV. People are capable and in
fact do make decisions to benefit a group out of pure altruism.&lt;/li>
&lt;/ul>
&lt;h2 id="empirical-data">Empirical Data&lt;/h2>
&lt;p>I started a book club in February 2023 and since the beginning I pushed for the
rule that if you don&amp;rsquo;t come, you pay for everyone&amp;rsquo;s drinks next time. The club
has been meeting almost every week for over a year and is growing. I believe
this rule contributed to the success of the group but of course there are too
many factors to know for sure and I am heavily biased. I can think of three
somewhat comparable groups (without such a rule) I attended in the last three
years that fizzled out after 2 months. But again, too many factors to know for
sure. I have one concrete counter example where a group keeps meeting without
such a rule. In this case I believe it is a combination of one person committing
to always being there and the pool of potential attendees being so large it
works out even if everyone is spontaneous.&lt;/p>
&lt;p>I would be very interested in hearing other people&amp;rsquo;s experiences or someone
trying a (somewhat) controlled experiment.&lt;/p>
&lt;h2 id="credits">Credits&lt;/h2>
&lt;ul>
&lt;li>Many thanks to Anjali, Bijay, Catarina, Daniel
(&lt;a href="https://sevensecularsermons.org">@7secularsermons&lt;/a>), Hauke, Nawid and Robert
for proof reading, criticism and suggestions.&lt;/li>
&lt;li>Image with pocket and community cards:
&lt;ul>
&lt;li>Bob de Becker&lt;/li>
&lt;li>License CC-BY-2.0&lt;/li>
&lt;li>&lt;a href="https://commons.wikimedia.org/wiki/File:All_in_(23243546592).jpg">https://commons.wikimedia.org/wiki/File:All_in_(23243546592).jpg&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Gold dollar coin
&lt;ul>
&lt;li>(I removed the white background and converted it to webp format)&lt;/li>
&lt;li>Coin: James B. Longacre. Image by Lost Dutchman Rare Coins&lt;/li>
&lt;li>License CC BY-SA 3.0 US Deed&lt;/li>
&lt;li>&lt;a href="https://commons.wikimedia.org/wiki/File:1852_gold_dollar_obverse.jpg">https://commons.wikimedia.org/wiki/File:1852_gold_dollar_obverse.jpg&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>The mystery of the second regression line</title><link>https://www.codeandbugs.com/post/second-regression-line/</link><pubDate>Thu, 05 Oct 2023 08:29:19 +0200</pubDate><guid>https://www.codeandbugs.com/post/second-regression-line/</guid><description>&lt;p>A few days ago I was stumped by a question that came up while studying Chapter
10 &amp;ldquo;Regression&amp;rdquo; of &lt;em>Statistics&lt;/em> by Freedman, Pisani and Purves.&lt;/p>
&lt;p>The context is regression with two variables.&lt;/p>
&lt;p>Notation:&lt;/p>
&lt;ul>
&lt;li>σ (sigma) and SD: standard deviation&lt;/li>
&lt;li>μ (mu): mean&lt;/li>
&lt;li>r: Pearson correlation coefficient&lt;/li>
&lt;li>x and y: the two variables&lt;/li>
&lt;li>$\sigma_x$: standard deviation of x&lt;/li>
&lt;li>$\mu_x$: mean of x&lt;/li>
&lt;/ul>
&lt;p>Chapter 8 had introduced the concept of the &lt;em>SD line&lt;/em>, which is the line that
crosses the point of means $(\mu_x,\mu_y)$ as well as
$(\mu_x+\sigma_x,\mu_y+\sigma_y)$, $(\mu_x-\sigma_x,\mu_y-\sigma_y)$,
$(\mu_x+2\cdot\sigma_x,\mu_y+2\cdot\sigma_y)$ and all other points that are an
equal number of SDs away from the point of means.&lt;/p>
&lt;p>For example here is a scatter diagram of ficticious height and weight data with
the &lt;em>SD line&lt;/em>. For those less familiar with the metric system, the mean
values 171cm and 87kg are about 5ft 7in and 192lb respectively.&lt;/p>
&lt;p>&lt;img src="plot1.svg" alt="Scatter plot with SD line" title="Scatter plot with SD line">&lt;/p>
&lt;p>Chapter 8 also introduces the correlation coefficient $r$ which measures how
strong the linear association between the variables is. The closer it is to 1
(or -1) the stronger the variables are associated. In Chapter 9 we learn that
the correlation coefficient does not change if we interchange the variables.
That is, weight is as correlated with height as height is with weight.&lt;/p>
&lt;p>In our example case $r = 0.462$&lt;/p>
&lt;p>In Chapter 10 the idea of the regression line is introduced. The regression
line is a line that best fits the data, minimizing vertical distance to the
points. It allows to predict for each value of x (height) the mean value of
y (weight). The chapter also explains that the slope of the &lt;em>SD line&lt;/em> is
$\frac{\sigma_y}{\sigma_x}$ and the slope of the regression line is
$r\frac{\sigma_y}{\sigma_x}$&lt;/p>
&lt;p>&lt;img src="plot2.svg" alt="Scatter plot with SD line and regression line" title="Scatter plot with
SD line and regression line">&lt;/p>
&lt;p>This green regression line will tell you for each value of x (height) the mean
value of y (weight). If you divide the plot into columns, the regression line
aproximately passes through the mean y (weight) value within each column.&lt;/p>
&lt;p>So far so good.&lt;/p>
&lt;p>Then, however, we learn that there is a second regression line, namely the one
that for each value of $y$ (weight) predicts the mean value of $x$ (height). That
might sound similar, but is not the same thing. If you divide the plot into
rows, this second regression line will aproximately pass through the mean x
(height) value for each row.&lt;/p>
&lt;p>The book gives no further details on how to calculate this second regression
line. What is its slope? We know that $r$ never changes and that the slope
must depend on $\sigma_x$ and $\sigma_y$ in some way. Therefore, it must be
$r\frac{\sigma_x}{\sigma_y}$, right? We just invert the standard deviations.&lt;/p>
&lt;p>Let&amp;rsquo;s plot the result.&lt;/p>
&lt;p>&lt;img src="plot3.svg" alt="Scatter plot with SD line, one correct and one incorrect regression
line" title="Scatter plot with SD line, one correct and one incorrect
regression line">&lt;/p>
&lt;p>It looks off. In the examples in the book both regression lines were
symmetrical with respect to the &lt;em>SD line&lt;/em>, whereas here the first regression
line is between the second regression line and the &lt;em>SD line&lt;/em>. Also, the second
regression line is supposed to minimize the horizontal distance to the points.
If you look at the bottom of the graph you can see that the line is far away
from all points. The same is true for the top of the graph.&lt;/p>
&lt;p>In the image below I have marked the points that are too far away from the
second (orange) regression line with red circles. Remember that now we are
trying to minimize the HORIZONTAL distance, which I have indicated with the
olive-green colored arrows.&lt;/p>
&lt;p>&lt;img src="plot3_notes.svg" alt="Scatter plot with SD line, one correct and one incorrect regression line as
well as some notes" title="Scatter plot with SD line, one correct and
one incorrect regression line as well as some notes">&lt;/p>
&lt;p>So, what should we change? If we use $r\frac{\sigma_y}{\sigma_x}$ we get the
slope of the first regression line, which can&amp;rsquo;t be right. And we know $r$
cannot change.&lt;/p>
&lt;p>This is the mystery I was pondering. What is the slope given the above
constraints?&lt;/p>
&lt;p>The solution to the mystery is that the second regression line calculates $x$
with respect to $y$. So the equation is $x = slope \cdot y + intercept$. And
here slope is precisely $r\frac{\sigma_x}{\sigma_y}$. If we re-order the terms
to have $y$ on the left hand as is usual we get $y = \frac{x -
intercept}{slope} = \frac{1}{slope}x - \frac{intercept}{slope}$&lt;/p>
&lt;p>And $\frac{1}{slope}$ is the same as $\frac{1}{r} \cdot
\frac{\sigma_y}{\sigma_x}$ so the only thing that changes between the slopes of
the two regression lines is that the first one includes $r$ and the second one
$\frac{1}{r}$&lt;/p>
&lt;p>We can now plot that line and voilà.&lt;/p>
&lt;p>&lt;img src="plot4.svg" alt="Scatter plot with SD line and two correct regression lines" title="Scatter plot with SD line and two correct regression lines">&lt;/p>
&lt;p>The equation of the &lt;em>SD line&lt;/em> is: $y = 1.38\cdot x - 149$&lt;/p>
&lt;p>The equation of the first regression line (green) is: $y = 0.638\cdot x - 22$&lt;/p>
&lt;p>The equation of the second regression line (orange) is: $y = 2.99\cdot x - 424$&lt;/p>
&lt;p>You can verify for yourself that if you multiply $r$ by the slope of the &lt;em>SD
line&lt;/em> (1.38) you&amp;rsquo;ll get the slope of the first (green) regression line and if you
multiply $\frac{1}{r}$ by the slope of the &lt;em>SD line&lt;/em> you&amp;rsquo;ll get the slope of
the second (orange) regression line.&lt;/p>
&lt;p>If we normalize the data (i.e. center on the mean and plot each point as the
number of SDs distance to the mean) then the slope of the &lt;em>SD line&lt;/em> will always
be 1, the slope of the first regression line will be $r$ and the slope of the
second regression line $\frac{1}{r}$ (since both SDs are 1 by definition).&lt;/p>
&lt;p>&lt;img src="plot5.svg" alt="Scatter plot with SD line and two correct regression lines
(normalized)" title="Scatter plot with SD line and two correct regression
lines (normalized)">&lt;/p>
&lt;p>The equations in the normalized plot are as follows.&lt;/p>
&lt;p>&lt;em>SD line&lt;/em>: $y = x$&lt;/p>
&lt;p>First regression line (green): $y = 0.462\cdot x$&lt;/p>
&lt;p>Second regression line (orange): $y = 2.165\cdot x$&lt;/p>
&lt;p>You can find the Python code used to generate the data and plots on GitHub:
&lt;a href="https://gist.github.com/omarkohl/433968aa54d75e34a5c8b5c50a259ed7">https://gist.github.com/omarkohl/433968aa54d75e34a5c8b5c50a259ed7&lt;/a>&lt;/p></description></item><item><title>Statistical Discrimination</title><link>https://www.codeandbugs.com/post/statistical-discrimination/</link><pubDate>Thu, 13 Apr 2023 09:15:50 +0200</pubDate><guid>https://www.codeandbugs.com/post/statistical-discrimination/</guid><description>&lt;p>Let&amp;rsquo;s assume &lt;em>Rivermoor College&lt;/em> offers 100 open spots for next year.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_open-spots.webp" alt="">&lt;/p>
&lt;p>Let&amp;rsquo;s also assume that 100 women apply &amp;hellip;&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_female-applicants.webp" alt="">&lt;/p>
&lt;p>&amp;hellip; as well as 100 men.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_male-applicants.webp" alt="">&lt;/p>
&lt;p>The women and men are equally well qualified. There are also no differences
concerning race, sexual orientation or some other common discrimination
factors.&lt;/p>
&lt;p>At the end of the application process the result is that 60 out of 100 men
(i.e. 60%) were accepted to this college but only 40 out of 100 women (40%).
Can we conclude that sex-based discrimination took place?&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_accepted-applicants.webp" alt="">&lt;/p>
&lt;p>No matter if your answer is Yes or No, please spend a few minutes thinking
about WHY you could be right or wrong before you continue reading. How sure are
you? Imagine reading the headline: &lt;em>Study finds &amp;ldquo;Rivermoor College&amp;rdquo; accepts 40%
of women and 60% of men&lt;/em>. Would you feel outrage? Would you be convinced from
the beginning that this can&amp;rsquo;t be true?&lt;/p>
&lt;p>&lt;em>Whitespace to encourage you to think&amp;hellip;&lt;/em>&lt;/p>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;br>
&lt;p>Below is a legend for how to read all the diagrams in this post.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_legend.webp" alt="">&lt;/p>
&lt;p>Let&amp;rsquo;s look more closely what majors this college offers. Namely three different
majors that we&amp;rsquo;ll call A, B and C. The number of spots they offer for different
majors differs, however. 70 spots for major A, 20 spots for major B and 10
spots for major C.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_open-spots-by-major.webp" alt="">&lt;/p>
&lt;p>Now let&amp;rsquo;s look at how many women and how many men apply to each major.&lt;/p>
&lt;p>Major A (with 70 open spots) gets 20 applications by women and 80 applications
by men.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_major-a.webp" alt="">&lt;/p>
&lt;p>Major B (with 20 open spots) gets 20 applications by women and 10 applications
by men.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_major-b.webp" alt="">&lt;/p>
&lt;p>Major C (with 10 open spots) gets 60 applications by women and 10 applications
by men.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_major-c.webp" alt="">&lt;/p>
&lt;p>As we can see, men and women differ in their preferences.&lt;/p>
&lt;p>How are the acceptance rates within the majors?&lt;/p>
&lt;p>For major A, 15 out of 20 women get accepted (75%) and 55 out of 80 men (69%).&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_accepted-major-a.webp" alt="">&lt;/p>
&lt;p>Therefore, there is in fact discrimination against the men (because they are
less likely to get into the major they applied for, even though there is no
meaningful distinction between them and the women applying).&lt;/p>
&lt;p>The same is true for major B. 16 out of 20 women (80%) and 4 out of 10 men
(40%) get accepted.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_accepted-major-b.webp" alt="">&lt;/p>
&lt;p>And for major C. 9 out of 60 women (15%) and 1 out of 10 men (10%) get
accepted.&lt;/p>
&lt;p>&lt;img src="./simpsons_paradox_accepted-major-c.webp" alt="">&lt;/p>
&lt;p>Below are all the numbers summarized in a table.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Major&lt;/th>
&lt;th>Open Spots&lt;/th>
&lt;th colspan="3">Women&lt;/th>
&lt;th colspan="3">Men&lt;/th>
&lt;/tr>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>Applicants&lt;/th>
&lt;th>Accepted&lt;/th>
&lt;th>% Accepted&lt;/th>
&lt;th>Applicants&lt;/th>
&lt;th>Accepted&lt;/th>
&lt;th>% Accepted&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;th>A&lt;/th>
&lt;td>70&lt;/td>
&lt;td>20&lt;/td>
&lt;td>15&lt;/td>
&lt;td>75%&lt;/td>
&lt;td>80&lt;/td>
&lt;td>55&lt;/td>
&lt;td>69%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>B&lt;/th>
&lt;td>20&lt;/td>
&lt;td>20&lt;/td>
&lt;td>16&lt;/td>
&lt;td>80%&lt;/td>
&lt;td>10&lt;/td>
&lt;td>4&lt;/td>
&lt;td>40%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>C&lt;/th>
&lt;td>10&lt;/td>
&lt;td>50&lt;/td>
&lt;td>9&lt;/td>
&lt;td>15%&lt;/td>
&lt;td>10&lt;/td>
&lt;td>1&lt;/td>
&lt;td>10%&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Total&lt;/th>
&lt;td>100&lt;/td>
&lt;td>100&lt;/td>
&lt;td>40&lt;/td>
&lt;td>40%&lt;/td>
&lt;td>100&lt;/td>
&lt;td>60&lt;/td>
&lt;td>60%&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>For any woman it is more likely she will get into the major she wants than for
an equally qualified man and yet overall it looks like women are being
discriminated against. The reason being that the women show a preference for
the majors with fewer spots (i.e. the ones where it&amp;rsquo;s harder to get into). The
real discriminatory trend against men reverses when combining the groups giving
the impression of discrimination against women.&lt;/p>
&lt;p>This phenomenon is called Simpson&amp;rsquo;s paradox.&lt;/p>
&lt;blockquote>
&lt;p>Simpson&amp;rsquo;s paradox is a phenomenon in probability and statistics in which a
trend appears in several groups of data but disappears or reverses when the
groups are combined. This result is often encountered in social-science and
medical-science statistics, and is particularly problematic when frequency
data are unduly given causal interpretations.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Wikipedia&lt;/a>&lt;/p>
&lt;p>&lt;strong>Note:&lt;/strong> The point of this post is not to claim that everything that looks
like discrimination is in fact a statistical effect or is in fact reverse
discrimination. The reason for choosing a hypothetical example with sexual
discrimination is to make you, the reader, more likely to remember Simpson&amp;rsquo;s
paradox. I suspect that we as humans remember things that cause strong emotions
better, in particular if they look like injustice. The data I use is completely
made up. &lt;em>Rivermoor College&lt;/em> does not exist as far as I know and should such a
college exist that is a mere coincidence. I acknowledge that for simplicity
this post assumed two genders but this is not meant to discriminate against
anyone who does not identify with said genders.&lt;/p>
&lt;p>&lt;strong>Note:&lt;/strong> Were you immediately convinced that the &lt;em>Rivermoor College&lt;/em> headline
could only be a lie and are you feeling smug right now? How could a single
headline give you enough information to come to such a strong conclusion? Did
you in fact have multiple hypotheses in mind, one of which should have been
&amp;ldquo;real discrimination against women is taking place&amp;rdquo;?&lt;/p>
&lt;p>Diagrams created with Inkscape. &lt;a href="./simpsons_paradox.svg">Source file&lt;/a>.&lt;/p></description></item><item><title>Randomness</title><link>https://www.codeandbugs.com/post/randomness/</link><pubDate>Thu, 03 Sep 2015 14:05:38 +0100</pubDate><guid>https://www.codeandbugs.com/post/randomness/</guid><description>&lt;p>What makes somethings random? Which of the following sequences is more random?&lt;/p>
&lt;pre>
O &lt;b>X&lt;/b> O &lt;b>X&lt;/b> &lt;b>X&lt;/b> O &lt;b>X&lt;/b> &lt;b>X&lt;/b> O &lt;b>X&lt;/b> O &lt;b>X&lt;/b> &lt;b>X&lt;/b> O &lt;b>X&lt;/b> O O &lt;b>X&lt;/b> O &lt;b>X&lt;/b> O
&lt;/pre>
&lt;pre>
&lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b> O O &lt;b>X&lt;/b> O O O &lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b> O O O &lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b> &lt;b>X&lt;/b>
&lt;/pre>
&lt;p>Most of us would probably say the first sequence looks more random than the
second. This is because we as human beings are notoriously bad at judging
randomness, which is the source of many fallacies and biases (such as the
gambler&amp;rsquo;s fallacy).&lt;/p>
&lt;p>I &lt;em>made up&lt;/em> the first sequence to make it appear random. The second one was
obtained by flipping a real 2 Euro coin and writing down the results.&lt;/p>
&lt;p>Why does the first sequence look more random? Because we don&amp;rsquo;t trust long
sequences of the same element. For example consider the final 5 Xs in the
second sequence. If I were to flip the coin again how much would you bet on it
being another X (tails) or O (heads). Our intuition tells us that O &amp;lsquo;is due&amp;rsquo;
(a.k.a. the gambler&amp;rsquo;s fallacy). But the truth is that the coin has no memory and
both results are equally likely &lt;em>no matter what has happened before&lt;/em>.&lt;/p>
&lt;p>If you were to flip a coin 10 times it is not unlikely for you to get a very
uneven result (e.g. 7 heads and 3 tails) even though the probability of each one
is 50%. But if you flip a coin 10.000.000 times then it is almost impossible
that you&amp;rsquo;d get 7.000.000 heads and 3.000.000 tails. You would get around
5.000.000 each. This is called the law of big numbers. Things tend to even out
in the long run. You will have very long runs of only heads but then you will
also have long runs of only tails, and in the end they even out (more or less).&lt;/p>
&lt;p>This is the reason why statistically speaking small samples are unreliable. It
is more likely to get extreme results!&lt;/p>
&lt;p>Imagine a country where people like to eat 10 types of candy. Each has a
different flavour (e.g. chocolate, strawberry, &amp;hellip;). And imagine the preference
for a certain flavour was evenly distributed across the whole country. 10% of
people love chocolate, 10% strawberry etc. You are the representative of the
candy-manufacturing company and you want to know if production should favour
one flavour over the other. Therefore you want to conduct a survey. You choose
the smallest of samples: 1 person. You ask just one person. This person tells
you he loves pineapple flavoured candy. You deduce from your data that 100% of
people eat pineapple candy. Now imagine you choose a bigger sample of 10
people. Do you think it likely that there will be exactly one person per
flavour leading to the correct 10% each flavour result? It is unlikely that
this will happen, therefore you will still get results that don&amp;rsquo;t match the
reality of what people like.&lt;/p>
&lt;h2 id="how-to-tell-if-something-is-random">How to tell if something is random?&lt;/h2>
&lt;p>Short answer: You can&amp;rsquo;t. At least not with certainty. Why is that? Because in a
random sequence every possible outcome is possible, even the ones that
intuitively don&amp;rsquo;t look random (as seen at the beginning). Thus assume someone
gives you the sequence 11111111111111111 and asks you if it is random. You
cannot tell. It does not look random, but possibly it came out of a true random
number generator, or it is the result of someone flipping a coin.&lt;/p>
&lt;p>What you can do is perform some mathematical tests to see if the sequence you
got looks random. But it is both possible to generate a sequence that looks
random but isn&amp;rsquo;t (you just need to know the rules used for checking) and it is
possible to get a random sequence that does not pass the tests and does not
look random.&lt;/p>
&lt;p>The only thing you can do is choose your random number generator properly and
trust it.&lt;/p>
&lt;h2 id="why-does-it-matter">Why does it matter?&lt;/h2>
&lt;p>Randomness is hugely important for computer cryptography. Very often secret
keys are generated using a random number generator. If the generator is bad,
the key will be bad and can potentially be guesses/calculated (see link below
&lt;em>How I Met Your Girlfriend&lt;/em>).&lt;/p>
&lt;h2 id="prng-pseudo-random-number-generator">PRNG (Pseudo random number generator)&lt;/h2>
&lt;p>A PRNG generates &lt;em>random&lt;/em> numbers in some arithmetic (mathematical) way and is
repeatable. One basic example is the &lt;em>Middle square method&lt;/em> that was described
in the middle ages and re-invented by John von Neumann.&lt;/p>
&lt;p>We take some number (we call it the &lt;em>seed&lt;/em>) and multiply it by itself. Then we
take the middle digits of the result as the first &lt;em>random&lt;/em> number. Repeat the
process with this new &lt;em>random&lt;/em> number.&lt;/p>
&lt;p>For instance if the seed is 42:&lt;/p>
&lt;pre>&lt;code>42 * 42 = 1765
The middle digits are 76
76 * 76 = 5776
The middle digits are 77
77 * 77 = 5929
The middle digits are 92
etc.
&lt;/code>&lt;/pre>
&lt;p>This gives us following sequence of numbers: 76, 77, 92, 46, 11, 12, 14, 19, 36, 29, 84, 5, 2&lt;/p>
&lt;p>They look pretty random don&amp;rsquo;t they?&lt;/p>
&lt;p>The main problem with PRNGs is that they tend to form &lt;em>circles&lt;/em> where values repeat themselves.&lt;/p>
&lt;p>For instance if we take 79 as the seed:&lt;/p>
&lt;pre>&lt;code>79 * 79 = 6241
The middle digits are 24
24 * 24 = 576
The middle digits are 57 (0576)
57 * 57 = 3249
The middle digits are 24
24 * 24 = 576
The middle digits are 57 (0576)
57 * 57 = 3249
The middle digits are 24
24 * 24 = 576
The middle digits are 57 (0576)
etc.
&lt;/code>&lt;/pre>
&lt;p>The resulting sequence is therefore: 79, 24, 57, 24, 57, 24, &amp;hellip;&lt;/p>
&lt;p>An attacker who observes the output of the PRNG will be able to predict the
next value before it happens. These values are no longer random.&lt;/p>
&lt;p>Another problem with the &lt;em>Middle square method&lt;/em> is that if the middle digits
are 00 then all following values will be 00 as well (because 0 * 0 = 0).&lt;/p>
&lt;p>This is what happens with the first sequence above (the one that started with
42 * 42 = 76). If we continue:&lt;/p>
&lt;pre>&lt;code>2 * 2 = 4
The middle digits are 00 (0004)
0 * 0 = 0
The middle digits are 00 (0000)
0 * 0 = 0
etc.
&lt;/code>&lt;/pre>
&lt;p>Kevin Mitnick describes an amusing story in &lt;em>The Art of Intrusion&lt;/em> about
hacking a Casino machine by timing the exact moment to hit the &lt;em>Play&lt;/em> button.
They had found out what kind of PRNG (a LFSR - Linear Feedback Shift Register)
the machine used and by playing once and then entering the cards displayed by
the machine into their computer they were able to calculate how long it would
take the machine to make the full &lt;em>circle&lt;/em> and get back to &lt;em>Royal Flush&lt;/em>.&lt;/p>
&lt;p>The big advantage of PRNGs is that they are very cheap and very fast. And being
able to repeat the values (by supplying the same seed as the first time) is
also an advantage when you only want to test your machine or software.&lt;/p>
&lt;h2 id="true-random-number-generator">True Random Number Generator&lt;/h2>
&lt;p>A TRNG (True Random Number Generator) is a hardware device that observes some
unpredictable physical event and records the results. For example you might
build a machine that observes a casino roulette and outputs the results as
random numbers. In practice this machine would be very slow and therefore
expensive but it would work.&lt;/p>
&lt;p>Very often microscopic events such as thermal noise, radioactive decay,
photoelectric effect etc. are used because of their unpredictable nature.&lt;/p>
&lt;p>It is possible to do this in software by measuring (in theory) unpredictable
events such as the time between keystrokes, mouse movements, arrival time of
network packets etc. In theory a very sophisticated attacker could manipulate a
lot of these events but in practice it seems to be good enough.&lt;/p>
&lt;h1 id="more-info">More info&lt;/h1>
&lt;ul>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Gambler%27s_fallacy">Gambler&amp;rsquo;s fallacy&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://cs.ucsb.edu/~koc/ns/docs/slides/14-pgp/chap5-prng.pdf">Pseudorandom Bits and Sequences&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Hardware_random_number_generator">Hardware random number generator&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">Cryptographically secure pseudorandom number generator&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.youtube.com/watch?v=fEmO7wQKCMw">DEFCON 18: How I Met Your Girlfriend - Part 1&lt;/a>,
&lt;a href="https://www.youtube.com/watch?v=2ctRfWnisSk">Part 2&lt;/a>,
&lt;a href="https://www.youtube.com/watch?v=vJtmZZGcR54">Part 3&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>JavaScript: this and that</title><link>https://www.codeandbugs.com/post/js-this-and-that/</link><pubDate>Tue, 01 Sep 2015 11:21:05 +0200</pubDate><guid>https://www.codeandbugs.com/post/js-this-and-that/</guid><description>&lt;p>Have you ever wondered about the JavaScript &lt;em>this&lt;/em> and &lt;em>that&lt;/em> variables?&lt;/p>
&lt;h2 id="this">&lt;em>this&lt;/em>&lt;/h2>
&lt;p>The explanation is quite simple. Every JavaScript (JS) function implicitly has
a variable called &lt;em>this&lt;/em>. The value of this variable depends on the way the
functions is called.&lt;/p>
&lt;p>For instance if the function is called as a method then &lt;em>this&lt;/em> is a reference
to the object on whom you are calling the method.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">myfunc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">newValue&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">newValue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">someObj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#a6e22e">value&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">someObj&lt;/span>.&lt;span style="color:#a6e22e">mymethod&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">myfunc&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">someObj&lt;/span>.&lt;span style="color:#a6e22e">mymethod&lt;/span>(&lt;span style="color:#ae81ff">123&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">someObj&lt;/span>.&lt;span style="color:#a6e22e">value&lt;/span>); &lt;span style="color:#75715e">// value === 123
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>If you call that function simply as a function, then &lt;em>this&lt;/em> is a reference to
the global context (window). For example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">myfunc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>(&lt;span style="color:#a6e22e">newValue&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">newValue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// value === undefined
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// window.value === undefined
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">myfunc&lt;/span>(&lt;span style="color:#ae81ff">123&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">value&lt;/span>); &lt;span style="color:#75715e">// global variable value === 123
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(window.&lt;span style="color:#a6e22e">value&lt;/span>); &lt;span style="color:#75715e">// global variable value === 123
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="that">&lt;em>that&lt;/em>&lt;/h2>
&lt;p>Now the real problem comes when you try to define a function inside a method
(e.g. to declare a callback that is triggered on some event).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">buttonHandler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">element&lt;/span>&lt;span style="color:#f92672">:&lt;/span> document.&lt;span style="color:#a6e22e">getElementById&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;bigButton&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">counter&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">startCounting&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Start counting...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">element&lt;/span>.&lt;span style="color:#a6e22e">onclick&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Clicked on button&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">counter&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">buttonHandler&lt;/span>.&lt;span style="color:#a6e22e">startCounting&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Click on the button 5 times
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">buttonHandler&lt;/span>.&lt;span style="color:#a6e22e">counter&lt;/span>); &lt;span style="color:#75715e">// counter === 0, why is that?
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>The function that is triggered by &lt;em>onclick&lt;/em> events tries to increase the
counter of the &lt;em>buttonHandler&lt;/em> but &lt;em>this&lt;/em> is no longer a reference to the
&lt;em>buttonHandler&lt;/em> object but to the global context (window). (The global variable
&lt;em>counter&lt;/em> does have value 5. Is that what you intended?)&lt;/p>
&lt;p>The solution is a simple &lt;strong>convention&lt;/strong>. Create a variable &lt;em>that&lt;/em> that points
to the outer &lt;em>this&lt;/em> and can be used inside the callback functions.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">buttonHandler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">element&lt;/span>&lt;span style="color:#f92672">:&lt;/span> document.&lt;span style="color:#a6e22e">getElementById&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;bigButton&amp;#34;&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">counter&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">startCounting&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Start counting...&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">that&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">this&lt;/span>.&lt;span style="color:#a6e22e">element&lt;/span>.&lt;span style="color:#a6e22e">onclick&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Clicked on button&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">that&lt;/span>.&lt;span style="color:#a6e22e">counter&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">buttonHandler&lt;/span>.&lt;span style="color:#a6e22e">startCounting&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Click on the button 5 times
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">console&lt;/span>.&lt;span style="color:#a6e22e">log&lt;/span>(&lt;span style="color:#a6e22e">buttonHandler&lt;/span>.&lt;span style="color:#a6e22e">counter&lt;/span>); &lt;span style="color:#75715e">// counter === 5
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="further-reads">Further reads&lt;/h2>
&lt;ul>
&lt;li>Douglas Crockfords excellent book &lt;em>Javascript: The Good Parts&lt;/em>&lt;/li>
&lt;li>A very insightful &lt;a href="http://yehudakatz.com/2011/08/11/understanding-javascript-function-invocation-and-this/">blogpost by Yehuda
Katz&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>